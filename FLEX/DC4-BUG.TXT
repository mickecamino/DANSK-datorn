 OPT PAG
 TTL DC4-MONITOR VER. 4.1
 PAG

** COPYRIGHT 1984
** HANS DALGAARD, SIVSANGERVEJ 4, 9800 HJ\RRING
** TELF. 08-924245

*
* Revision history:
* 30/05/87 POR - Change of directory eprom size now (27256)
* 30/05/87 POR - Correction of commandsearch routine RDUSCM
* 30/05/87 POR - Remove of call to nowhere EXTCRT
* 11/06/87 POR - Symbol CMDCAT added start of cat in eprom #12


 ORG $E742
STACK  EQU *-1
SYSBYT RMB 1        SYSTEM POVER ON BYTE
EXTBYT RMB 1        $FF FOR SYSTEM EPROM
EPRSTR RMB 2        EPROM LOAD ADR.
EPREND RMB 2        EPROM END ADR.
EPRTFR RMB 2        EPROM TRANSFER ADR
EPROFF RMB 2        EPROM OFFSET
EPRLNK RMB 1        EPROM LINK NR
BCOBYT RMB 1        3. BANK FOR COPY
PRTLNG RMB 1        SIDE L[NGDE
PRTPSK RMB 1        PRINTER EJECT
PRTBOT RMB 1        PRINTERRAM START
PRTTOP RMB 1        PRINTERRAM END
PBANK1 RMB 1        POINTER BANK IND
SPIND  RMB 2
PBANK2 RMB 1        POINTER BANK OUT
SPOUT  RMB 2
PRTANT RMB 1        PRINT ANTAL
       RMB 2
PLSTCH RMB 1        LAST PRINTER CHAR
PIOLST RMB 1
SCEFLG RMB 1
FIRST  RMB 1        PRINTER START
PRTMAR RMB 1        PRINTER LEFT MARGEN
PRTSZ1 RMB 2        PRINTER BUFFER SIZE START
PRTSZ2 RMB 2        CURRANT PRINTER BUFFER SIZE
PRTDP  RMB 1        PRINTER L[NGDE
PRTEJ  RMB 1        PRINTER EJ
PRTWRK RMB 2        PRINTER SCRATCH
TIMCON RMB 2        V[RDI FOR PRINTER TIMER
PAGENR RMB 2        ANTAL PAGE I BUFFER
MAXRAM RMB 1        HIGEST BANK
RAMSIZ RMB 2        RAMSIZE ON SYSTEM
TRACKS RMB 1        VDISK TRACKS
SECTOR RMB 2        VDISK SEKTORS
TIME   RMB 9        DATO (DD-MM-YY )
RTCTIM RMB 9        TIME+MIN (HH:MM:SS)
WEEKD  RMB 2        UGEDAG (AA)
WEEKN  RMB 2        UGENR (AA)
TIMER  RMB 9        TIMER (HH:MM:SS)
ALARM  RMB 8        ALARM (DDHHMMSS)
BASNUM RMB 7        BASEDIT DECIMALT AUTONR
BASCON RMB 2
BASPON RMB 2
BASWK1 RMB 2        BASEDIT SCRATCH
BASWK2 RMB 2        BASEDIT SCRATCH
       RMB 1
PFLAG1 RMB 1        PRINTER FLAG IRQ
PFLAG2 RMB 1        PRINTER FLAG INIT
AUNSTP RMB 1        BASEDIT AUTONR STEP
AUNNUM RMB 2        BASEDIT HEX AUTONR
TABCON RMB 1
BASBY1 RMB 1        BASEDIT SCRATCH
BASBY2 RMB 1        BASEDIT TEST $FF XBASIC ONN
BASBY3 RMB 1        BASEDIT TEST $FF BASEDIT ONN
BERRVC RMB 2        ERRORS VECTOR
AUTBYT RMB 1        $FF=AUTONR ON
LINWRK RMB 1        MONITOR SCRATCH
LINCON RMB 1        CHRAKTERCOUNTER
GRABYT RMB 1        1=GRAFIK ON
USABYT RMB 1        ALT. CHARAKTER
RTCBYT RMB 1        0=RTC ONBOARD
CLKBYT RMB 1        $FF=CLOCK RUN
CONTST RMB 2        MONITOR SCRATCH
KARCON RMB 1             "    "
CURTM1 RMB 2             "    "
CURTM2 RMB 2             "    "
CURTM3 RMB 1             "    "
CURTM4 RMB 2             "    "
WRKSPC RMB 6             "    "

INVEC  RMB 2        INCHRVECTOR
ESCVEC RMB 2        ESC VECTOR
FUNVEC RMB 2
CURADR RMB 2        CRT START ADRESSE
CURSTA RMB 2        SCROOL TOP
CUREND RMB 2        SCROOL BOTTOM
OUTADR RMB 2        OUTCHR VECTOR
CLRVEC RMB 2        CLR SCREEN VECTOR
LSTCUR RMB 1        CURRENT CURSOR
KEYVEC RMB 2        VECOTR FOR KEYBRD TABEL
RTCLOC RMB 2        RTC ADR. ON SCREEN
URMEND RMB 2        USER RAM END ADRESSE $EXXX
VTABLE RMB 2        VECVIR VECTOR TABLE
VWRITE RMB 2        WRITE ROUTINE VECTOR
NDRVRS RMB 1
GDRIVE RMB 1        GLOBAL DRIVE
LDRIVE RMB 1        LOCAL DRIVE
NESTCT RMB 1        ENTRY FLAG
DRIVET RMB 1        TEMP WORK SPACE
DIOVEC RMB 6        VDISK
TYPTBL RMB 8        VDISK
CLSBY1 RMB 1        MONOTOR SCRATCH
CLSBY2 RMB 1             "    "
RTCBTT RMB 1        RTCBYT TEN
RTCBTU RMB 1        RTCBYT UNIT
BNROUT RMB 2        VECTOR FOR AUTONR BASIC
       RMB 1

 ORG $DFC0
RAMVEC RMB 2
SWI3  RMB 2  SOFTWARE INTERRUPT VECTOR #3
SWI2  RMB 2  SOFTWARE INTERRUPT VECTOR #2
FIRQ  RMB 2  FAST INTERRUPT VECTOR
IRQ   RMB 2  INTERRUPT VECTOR
SWI   RMB 2  SOFTWARE INTERRUPT VECTOR
SVCVO RMB 2  SUPERVISOR CALL VECTOR ORGIN
SVCVL RMB 2  SUPERVISOR CALL VECTO,LIMIT
LRARAM RMB 16 LRA ADDRESSES
CPORT RMB 2  RE-VECTORABLE CONTROL PORT
ECHO  RMB 1  ECHO FLAG

CMDCAT EQU $7800  START OF COMMAND CATALOG EPROM #12
RTC    EQU $E002  REAL TIME CLOCK
ACIA1  EQU $E008    TERMIAL PORT
ACIA2  EQU $E004    FOTO PORT
CRTADR EQU $E010 CRT CONTROLLER
FLOPPY EQU $E014 WD 2797 FLOPPY CONTROLLER
PRMADR EQU $E020 EPROM ADR
PROMNR EQU $E022 EPROMNR
PRMDAT EQU $E023 EPROM DATA
VIA    EQU $E070 VIA 6522
BAUDBT EQU $32   $32=1200 BAUD

DREAD  EQU $DE24
DWRITE EQU $DE81
DVERFY EQU $DEE2
DRESTO EQU $CB0B
DDRIVE EQU $CB23
DCHECK EQU $CB5D
DQUICK EQU $DF7B
DINIT  EQU $CB00

CRTRAM EQU $E800
RAMEND EQU CRTRAM+LINANT*LINLNG
LINE25 EQU RAMEND
CRTREG EQU CRTADR+1
LINANT EQU 24 LINEANTAL = 24
LINLNG EQU 80 ANTAL KAR. PR LINE = 80

WHERE  EQU $C000 RAM LOAD LOCATION

IC11   EQU $FFF0 DAT RAM CHIP
WARMS EQU $CD03 FLEX WARM ENTRY

 PAG

 ORG $F000

 LIB DC4-BUG1

 ORG $F800
 FDB MONITOR
 FDB $FFFF
 FDB INCH
 FDB INCHE
 FDB INCHEK
 FDB OUTCH
 FDB PDATA
 FDB PCRLF
 FDB PSTRNG
 FDB $FFFF


MONBK JMP $CD03
 JMP INCH
 JMP INCHE
 JMP INCHEK
 JMP OUTCH
RTI RTI DUMMY

 PAG

 LIB DC4-BUG2

 PAG

 ORG $FF4D

** SYSTEM CONSTANTS

RAMPON FDB INHUP,NOESC,EXTFUN,CRTRAM,CRTRAM,RAMEND,OUTCHR
 FDB INCHEK
 FCB $68
 FDB KTAB1
 FDB LINE25+71,$FFFF
 FDB VECVIR,WRITV
 FCB DRVTOT,0,0,-1,0

 FCB 0,0 #0 GLOBAL DRIVE
 FCB 0,1 #1   "      "
 FCB 1,0 #2   "      "

 FDB VECGIM VECTOR FOR GIMIX
 FCB 2 HIGEST LOCAL DRV # ALLOWED
 FCC 'D' ID ( MUST BE UPPER CASE)
* DRIVE TYPE #1
 FDB VECVIR VECTO TABLE 4 VIRTUAL DRIVES
 FCB 0 ONLY ONE DRIVE
 FCC 'V' ID IS 'V' FOR VIRT DISK
* INSERT ANY OTHER DRIVE DESCRIPTORS HERE
DRVTOT EQU (*-TYPTBL)/4

 FCB 30,60
 FCB $02,$01
 FDB INHUP
 FCB $FF
POIEND EQU *

CRTTAB FCB $7F,$50,$62,$08
 FCB $1E,$02,$19,$1A
 FCB $00,$E9,$68,$09
 FDB $E800,$E800

* ** 6809 VECTOR ADDRESSES **

ROMVEC FDB RTI USER-V
 FDB RTI SWI3-V
 FDB RTI SWI2-V
 FDB RTI FIRQ-V
 FDB RTI IRQ-V
 FDB RTI SWI-V
 FDB $FFFF SVC-VO
 FDB $FFFF SVC-VL

V1 JMP [STACK]
V2 JMP [SWI2]
V3 JMP [FIRQ]
V4 JMP [IRQ]
V5 JMP [SWI]

KEYCON EQU *
F1 FCB $E0,$07      PAGE UPN
F2 FCB $E1,$05      PAGE DOWN
F3 FCB $E2,$0E      SCROLL UP
F4 FCB $E3,$0F      SCROLL DOWN
F5 FCB $E4,$19      INSERT LINE
F6 FCB $E5,$03      INSERT CHAR
F7 FCB $E6,$13      GO TO MARKED LINE
F8 FCB $E7,$16      INSERT SYMBOL
F9 FCB $E8,$12      TAB LEFT
F10 FCB $E9,$0B     DELETE CHAR
F11 FCB $EA,$06     DELETE TO END OF LINE
F12 FCB $EB,$1A     DELETE LINE
F13 FCB $9D,$FC
F14 FCB $9E,$FD
F15 FCB $A1,$FE
F16 FCB $A2,$FF
FTAB FCB $FF,$FF
KEYTEN EQU *

 ORG $FFD8
VECGIM JMP DREAD
 JMP DWRITE
 JMP DVERFY
 JMP DRESTO
 JMP DDRIVE
 JMP DCHECK
 JMP DQUICK
GCOLD JMP DINIT

 FDB V1 USER-V
 FDB RTI SWI3-V
 FDB V2 SWI2-V
 FDB V3 FIRQ-V
 FDB V4 IRQ-V
 FDB V5 SWI-V
 FDB NMISER NMI
 FDB SYSINT RESET

 PAG

 END SYSINT


